{"version":3,"file":"index.js","sources":["../src/helpers/base/is.js","../src/helpers/base/try/index.js","../src/helpers/base/globalThis.js","../src/helpers/utils.js","../src/helpers/saveScrollPosition.js","../src/core/manager.js","../src/core/context.js","../src/core/CacheComponent.js","../src/core/Updatable.js","../src/components/CacheRoute.js","../src/components/SwitchFragment.js","../src/components/CacheSwitch.js"],"sourcesContent":["// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nexport const isUndefined = val => typeof val === 'undefined'\n\nexport const isNull = val => val === null\n\nexport const isFunction = val => typeof val === 'function'\n\nexport const isString = val => typeof val === 'string'\n\nexport const isExist = val => !(isUndefined(val) || isNull(val))\n\nexport const isArray = val => val instanceof Array\n\nexport const isNaN = val => val !== val\n\nexport const isNumber = val => typeof val === 'number' && !isNaN(val)\n// 值类型判断 -------------------------------------------------------------\n","import { isString, isExist, isUndefined, isFunction, isNumber } from '../is'\n\nexport const get = (obj, keys = [], defaultValue) => {\n  try {\n    if (isNumber(keys)) {\n      keys = String(keys)\n    }\n    let result = (isString(keys) ? keys.split('.') : keys).reduce(\n      (res, key) => res[key],\n      obj\n    )\n    return isUndefined(result) ? defaultValue : result\n  } catch (e) {\n    return defaultValue\n  }\n}\n\nexport const run = (obj, keys = [], ...args) => {\n  keys = isString(keys) ? keys.split('.') : keys\n\n  const func = get(obj, keys)\n  const context = get(obj, keys.slice(0, -1))\n\n  return isFunction(func) ? func.call(context, ...args) : func\n}\n\nexport const value = (...values) =>\n  values.reduce(\n    (value, nextValue) => (isUndefined(value) ? run(nextValue) : run(value)),\n    undefined\n  )\n","const getImplementation = () => {\n  if (typeof self !== 'undefined') {\n    return self\n  }\n  if (typeof window !== 'undefined') {\n    return window\n  }\n  if (typeof global !== 'undefined') {\n    return global\n  }\n\n  throw new Error('unable to locate global object')\n}\n\nconst implementation = getImplementation()\n\nconst getGlobal = () => {\n  if (\n    typeof global !== 'object' ||\n    !global ||\n    global.Math !== Math ||\n    global.Array !== Array\n  ) {\n    return implementation\n  }\n  return global\n}\n\nconst globalThis = getGlobal()\n\nexport default globalThis\n","import { isArray } from './base/is'\n\nexport const nextTick = func => Promise.resolve().then(func)\n\nexport const flatten = array =>\n  array.reduce(\n    (res, item) => [...res, ...(isArray(item) ? flatten(item) : [item])],\n    []\n  )\n\n/**\n * [钳子] 用来将数字限制在给定范围内\n * @param {Number} value 被限制值\n * @param {Number} min 最小值\n * @param {Number} max 最大值\n */\nexport const clamp = (value, min, max = Number.MAX_VALUE) => {\n  if (value < min) {\n    return min\n  }\n\n  if (value > max) {\n    return max\n  }\n\n  return value\n}\n\nexport const ObjectValues = (object) => {\n  const res = []\n  for (let key in object) {\n    res.push(object[key])\n  }\n  return res\n}\n","import root from './base/globalThis'\nimport { get, run, value } from './base/try'\nimport { isArray, isFunction, isExist } from './base/is'\nimport { flatten } from './utils'\n\nconst body = get(root, 'document.body')\nconst screenScrollingElement = get(\n  root,\n  'document.scrollingElement',\n  get(root, 'document.documentElement', {})\n)\n\nfunction isScrollableNode(node = {}) {\n  if (!isExist(node)) {\n    return false\n  }\n\n  return (\n    node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight\n  )\n}\n\nfunction getScrollableNodes(from) {\n  if (!isFunction(get(root, 'document.getElementById'))) {\n    return []\n  }\n\n  return [...value(run(from, 'querySelectorAll', '*'), []), from].filter(\n    isScrollableNode\n  )\n}\n\nexport default function saveScrollPosition(from) {\n  const nodes = [\n    ...new Set([\n      ...flatten((!isArray(from) ? [from] : from).map(getScrollableNodes)),\n      ...[screenScrollingElement, body].filter(isScrollableNode)\n    ])\n  ]\n\n  const saver = nodes.map(node => [\n    node,\n    {\n      x: node.scrollLeft,\n      y: node.scrollTop\n    }\n  ])\n\n  return function revert() {\n    saver.forEach(([node, { x, y }]) => {\n      node.scrollLeft = x\n      node.scrollTop = y\n    })\n  }\n}\n","import CacheComponent from './CacheComponent'\nimport { get, run } from '../helpers'\n\nconst __components = {}\n\nconst getCachedComponentEntries = () =>\n  Object.entries(__components).filter(\n    ([, cache]) =>\n      cache instanceof CacheComponent\n        ? cache.state.cached\n        : Object.values(cache).some(cache => cache.state.cached)\n  )\n\nexport const getCache = () => ({ ...__components })\n\nexport const register = (key, component) => {\n  __components[key] = component\n}\n\nexport const remove = key => {\n  delete __components[key]\n}\n\nconst dropComponent = component => run(component, 'reset')\n\nexport const dropByCacheKey = key => {\n  const cache = get(__components, [key])\n\n  if (!cache) {\n    return\n  }\n\n  if (cache instanceof CacheComponent) {\n    dropComponent(cache)\n  } else {\n    Object.values(cache).forEach(dropComponent)\n  }\n}\n\nconst refreshComponent = component => run(component, 'refresh');\n\nexport const refreshByCacheKey = key => {\n  const cache = get(__components, [key]);\n\n  if (!cache) {\n    return;\n  }\n\n  if (cache instanceof CacheComponent) {\n    refreshComponent(cache);\n  } else {\n    Object.values(cache).forEach(refreshComponent);\n  }\n};\n\nexport const clearCache = () => {\n  getCachedComponentEntries().forEach(([key]) => dropByCacheKey(key))\n}\n\nexport const getCachingKeys = () =>\n  getCachedComponentEntries().map(([key]) => key)\n\nexport const getCachingComponents = () =>\n  getCachedComponentEntries().reduce(\n    (res, [key, cache]) => ({\n      ...res,\n      ...(cache instanceof CacheComponent\n        ? { [key]: cache }\n        : Object.entries(cache).reduce(\n            (res, [pathname, cache]) => ({\n              ...res,\n              [`${key}.${pathname}`]: cache\n            }),\n            {}\n          ))\n    }),\n    {}\n  )\n","import { useState, useEffect, useContext } from 'react'\nimport createContext from 'mini-create-react-context'\n\nimport { isArray, isFunction, run } from '../helpers'\n\nconst context = createContext()\n\nexport default context\nexport const { Provider } = context\n\nfunction useCacheRoute(lifecycleName, effect, deps = []) {\n  if (!isFunction(useContext)) {\n    return\n  }\n\n  const cacheLifecycles = useContext(context)\n  useEffect(() => {\n    const off = run(cacheLifecycles, 'on', lifecycleName, effect)\n\n    return () => run(off)\n  }, deps)\n}\nexport const useDidCache = useCacheRoute.bind(null, 'didCache')\nexport const useDidRecover = useCacheRoute.bind(null, 'didRecover')\n\nexport const useIsInCachedRecoveredPage = () => {\n  const [inCachedRecoveredPage, setInCachedRecoveredPage] = useState(false)\n  useDidRecover(() => setInCachedRecoveredPage(true))\n\n  return inCachedRecoveredPage\n}\n\nexport const useIsInActivePage = () => {\n  const [inActivePage, setInActivePage] = useState(true)\n\n  useEffect(() => setInActivePage(true), [])\n  useDidRecover(() => setInActivePage(true))\n  useDidCache(() => setInActivePage(false))\n\n  return inActivePage\n}\n","import React, { Component } from 'react'\r\nimport PropTypes from 'prop-types'\r\n\r\nimport {\r\n  run,\r\n  get,\r\n  value,\r\n  isExist,\r\n  isFunction,\r\n  saveScrollPosition,\r\n  ObjectValues\r\n} from '../helpers'\r\nimport * as manager from './manager'\r\nimport { Provider as CacheRouteProvider } from './context'\r\n\r\nconst isUsingNewLifecycle = isExist(React.forwardRef)\r\n\r\nexport const COMPUTED_UNMATCH_KEY = '__isComputedUnmatch'\r\nexport const isMatch = match =>\r\n  isExist(match) && get(match, COMPUTED_UNMATCH_KEY) !== true\r\n\r\nconst getDerivedStateFromProps = (nextProps, prevState) => {\r\n  let { match: nextPropsMatch, when = 'forward' } = nextProps\r\n\r\n  /**\r\n   * Note:\r\n   * Turn computedMatch from CacheSwitch to a real null value\r\n   *\r\n   * 将 CacheSwitch 计算得到的 computedMatch 值转换为真正的 null\r\n   */\r\n  if (!isMatch(nextPropsMatch)) {\r\n    nextPropsMatch = null\r\n  }\r\n\r\n  if (!prevState.cached && nextPropsMatch) {\r\n    return {\r\n      cached: true,\r\n      matched: true\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Determines whether it needs to cancel the cache based on the next unmatched props action\r\n   *\r\n   * 根据下个未匹配状态动作决定是否需要取消缓存\r\n   */\r\n  if (prevState.matched && !nextPropsMatch) {\r\n    const nextAction = get(nextProps, 'history.action')\r\n\r\n    let __cancel__cache = false\r\n\r\n    if (isFunction(when)) {\r\n      __cancel__cache = !when(nextProps)\r\n    } else {\r\n      switch (when) {\r\n        case 'always':\r\n          break\r\n        case 'back':\r\n          if (['PUSH', 'REPLACE'].includes(nextAction)) {\r\n            __cancel__cache = true\r\n          }\r\n\r\n          break\r\n        case 'forward':\r\n        default:\r\n          if (nextAction === 'POP') {\r\n            __cancel__cache = true\r\n          }\r\n      }\r\n    }\r\n\r\n    if (__cancel__cache) {\r\n      return {\r\n        cached: false,\r\n        matched: false\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    matched: !!nextPropsMatch\r\n  }\r\n}\r\n\r\nexport default class CacheComponent extends Component {\r\n  static __name = 'CacheComponent'\r\n\r\n  yPosition = 0\r\n\r\n  static propsTypes = {\r\n    history: PropTypes.object.isRequired,\r\n    match: PropTypes.object.isRequired,\r\n    children: PropTypes.func.isRequired,\r\n    className: PropTypes.string,\r\n    when: PropTypes.oneOfType([\r\n      PropTypes.func,\r\n      PropTypes.oneOf(['forward', 'back', 'always'])\r\n    ]),\r\n    behavior: PropTypes.func,\r\n    unmount: PropTypes.bool,\r\n    saveScrollPosition: PropTypes.bool\r\n  }\r\n\r\n  static defaultProps = {\r\n    when: 'forward',\r\n    unmount: false,\r\n    saveScrollPosition: false,\r\n    behavior: cached =>\r\n      cached\r\n        ? {\r\n          style: {\r\n            display: 'none'\r\n          }\r\n        }\r\n        : undefined\r\n  }\r\n\r\n  constructor(props, ...args) {\r\n    super(props, ...args)\r\n\r\n    this.__cacheCreateTime = Date.now()\r\n    this.__cacheUpdateTime = this.__cacheCreateTime\r\n    if (props.cacheKey) {\r\n      const cacheKey = run(props.cacheKey, undefined, props)\r\n      if (props.multiple) {\r\n        const { pathname } = props\r\n        manager.register(cacheKey, {\r\n          ...manager.getCache()[cacheKey],\r\n          [pathname]: this\r\n        })\r\n      } else {\r\n        manager.register(cacheKey, this)\r\n      }\r\n    }\r\n\r\n    if (typeof document !== 'undefined') {\r\n      const cacheKey = run(props.cacheKey, undefined, props)\r\n      this.__placeholderNode = document.createComment(\r\n        ` Route cached ${cacheKey ? `with cacheKey: \"${cacheKey}\" ` : ''}`\r\n      )\r\n    }\r\n\r\n    this.state = getDerivedStateFromProps(props, {\r\n      cached: false,\r\n      matched: false,\r\n      key: Math.random()\r\n    })\r\n  }\r\n\r\n  cacheLifecycles = {\r\n    __listener: {},\r\n    __didCacheListener: {},\r\n    __didRecoverListener: {},\r\n    on: (eventName, func) => {\r\n      const id = Math.random()\r\n      const listenerKey = `__${eventName}Listener`\r\n      this.cacheLifecycles[listenerKey][id] = func\r\n\r\n      return () => {\r\n        delete this.cacheLifecycles[listenerKey][id]\r\n      }\r\n    },\r\n    didCache: listener => {\r\n      this.cacheLifecycles.__listener['didCache'] = listener\r\n    },\r\n    didRecover: listener => {\r\n      this.cacheLifecycles.__listener['didRecover'] = listener\r\n    }\r\n  }\r\n\r\n  /**\r\n   * New lifecycle for replacing the `componentWillReceiveProps` in React 16.3 +\r\n   * React 16.3 + 版本中替代 componentWillReceiveProps 的新生命周期\r\n   */\r\n  static getDerivedStateFromProps = isUsingNewLifecycle\r\n    ? getDerivedStateFromProps\r\n    : undefined\r\n\r\n  /**\r\n   * Compatible React 16.3 -\r\n   * 兼容 React 16.3 - 版本\r\n   */\r\n  componentWillReceiveProps = !isUsingNewLifecycle\r\n    ? nextProps => {\r\n      const nextState = getDerivedStateFromProps(nextProps, this.state)\r\n\r\n      this.setState(nextState)\r\n    }\r\n    : undefined\r\n\r\n  __parentNode\r\n  __placeholderNode\r\n  __revertScrollPos\r\n  injectDOM = () => {\r\n    try {\r\n      run(\r\n        this.__parentNode,\r\n        'insertBefore',\r\n        this.wrapper,\r\n        this.__placeholderNode\r\n      )\r\n      run(this.__parentNode, 'removeChild', this.__placeholderNode)\r\n    } catch (err) {\r\n      // nothing\r\n    }\r\n  }\r\n\r\n  ejectDOM = () => {\r\n    try {\r\n      const parentNode = get(this.wrapper, 'parentNode')\r\n      this.__parentNode = parentNode\r\n\r\n      run(\r\n        this.__parentNode,\r\n        'insertBefore',\r\n        this.__placeholderNode,\r\n        this.wrapper\r\n      )\r\n      run(this.__parentNode, 'removeChild', this.wrapper)\r\n    } catch (err) {\r\n      // nothing\r\n    }\r\n  }\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (!prevState.cached || !this.state.cached) {\r\n      return\r\n    }\r\n\r\n    if (prevState.matched === true && this.state.matched === false) {\r\n      if (this.props.unmount) {\r\n        this.ejectDOM()\r\n      }\r\n      this.__cacheUpdateTime = Date.now()\r\n      ObjectValues(this.cacheLifecycles.__didCacheListener).forEach(func => {\r\n        run(func)\r\n      })\r\n      return run(this, 'cacheLifecycles.__listener.didCache')\r\n    }\r\n\r\n    if (prevState.matched === false && this.state.matched === true) {\r\n      if (this.props.saveScrollPosition) {\r\n        run(this.__revertScrollPos)\r\n      }\r\n      this.__cacheUpdateTime = Date.now()\r\n\r\n      window.scrollTo(0, this.yPosition)\r\n\r\n      ObjectValues(this.cacheLifecycles.__didRecoverListener).forEach(func => {\r\n        run(func)\r\n      })\r\n      return run(this, 'cacheLifecycles.__listener.didRecover')\r\n    }\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    const willRecover =\r\n      this.state.matched === false && nextState.matched === true\r\n    const willDrop = this.state.cached === true && nextState.cached === false\r\n    const shouldUpdate =\r\n      this.state.matched ||\r\n      nextState.matched ||\r\n      this.state.cached !== nextState.cached\r\n\r\n    if (shouldUpdate) {\r\n      if ((this.props.unmount && willDrop) || willRecover) {\r\n        this.injectDOM()\r\n      }\r\n\r\n      const shouldSaveScrollPosition = !(willDrop || willRecover)\r\n\r\n      if (shouldSaveScrollPosition) {\r\n        this.yPosition = window.pageYOffset\r\n      }\r\n\r\n      if (shouldSaveScrollPosition && this.props.saveScrollPosition) {\r\n        this.__revertScrollPos = saveScrollPosition(\r\n          this.props.unmount ? this.wrapper : undefined\r\n        )\r\n      }\r\n    }\r\n\r\n    return shouldUpdate\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const { unmount, pathname, multiple } = this.props\r\n    const cacheKey = run(this.props, 'cacheKey', this.props)\r\n\r\n    if (multiple) {\r\n      const cache = { ...manager.getCache()[cacheKey] }\r\n\r\n      delete cache[pathname]\r\n\r\n      if (Object.keys(cache).length === 0) {\r\n        manager.remove(cacheKey)\r\n      } else {\r\n        manager.register(cacheKey, cache)\r\n      }\r\n    } else {\r\n      manager.remove(cacheKey)\r\n    }\r\n\r\n    if (unmount) {\r\n      this.injectDOM()\r\n    }\r\n  }\r\n\r\n  reset = () => {\r\n    delete this.__revertScrollPos\r\n\r\n    this.setState({\r\n      cached: false\r\n    })\r\n  }\r\n\r\n  refresh = () => {\r\n    delete this.__revertScrollPos;\r\n\r\n    this.setState({\r\n      key: Math.random()\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { matched, cached, key } = this.state\r\n    const { className: propsClassName = '', behavior, children } = this.props\r\n    const { className: behaviorClassName = '', ...behaviorProps } = value(\r\n      run(behavior, undefined, !matched),\r\n      {}\r\n    )\r\n    const className = run(`${propsClassName} ${behaviorClassName}`, 'trim')\r\n    const hasClassName = className !== ''\r\n\r\n    return cached ? (\r\n      <div\r\n        key={key}\r\n        className={hasClassName ? className : undefined}\r\n        {...behaviorProps}\r\n        ref={wrapper => {\r\n          this.wrapper = wrapper\r\n        }}\r\n      >\r\n        <CacheRouteProvider value={this.cacheLifecycles}>\r\n          {run(children, undefined, this.cacheLifecycles)}\r\n        </CacheRouteProvider>\r\n      </div>\r\n    ) : null\r\n  }\r\n}\r\n","import { Component } from 'react'\nimport PropTypes from 'prop-types'\n\nimport { run, get } from '../helpers'\n\nexport default class Updatable extends Component {\n  static propsTypes = {\n    when: PropTypes.bool.isRequired\n  }\n\n  render = () => run(this.props, 'children')\n  shouldComponentUpdate = ({ when }) => when\n}\n","import React, { Component, Fragment } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport { Route } from 'react-router-dom'\r\n\r\nimport CacheComponent, { isMatch } from '../core/CacheComponent'\r\nimport Updatable from '../core/Updatable'\r\nimport { run, isExist, isNumber, clamp } from '../helpers'\r\n\r\nconst isEmptyChildren = children => React.Children.count(children) === 0\r\nconst isFragmentable = isExist(Fragment)\r\n\r\nlet counter = 0\r\n\r\nexport default class CacheRoute extends Component {\r\n  static __name = 'CacheRoute'\r\n\r\n  static propTypes = {\r\n    component: PropTypes.elementType || PropTypes.any,\r\n    render: PropTypes.func,\r\n    children: PropTypes.oneOfType([PropTypes.func, PropTypes.node]),\r\n    computedMatchForCacheRoute: PropTypes.object,\r\n    multiple: PropTypes.oneOfType([PropTypes.bool, PropTypes.number])\r\n  }\r\n\r\n  static defaultProps = {\r\n    multiple: false\r\n  }\r\n\r\n  cache = {}\r\n\r\n  render() {\r\n    let {\r\n      children,\r\n      render,\r\n      component,\r\n      className,\r\n      when,\r\n      behavior,\r\n      cacheKey,\r\n      unmount,\r\n      saveScrollPosition,\r\n      computedMatchForCacheRoute,\r\n      multiple,\r\n      ...restProps\r\n    } = this.props\r\n\r\n    /**\r\n     * Note:\r\n     * If children prop is a React Element, define the corresponding wrapper component for supporting multiple children\r\n     *\r\n     * 说明：如果 children 属性是 React Element 则定义对应的包裹组件以支持多个子组件\r\n     */\r\n    if (React.isValidElement(children) || !isEmptyChildren(children)) {\r\n      render = () => children\r\n    }\r\n\r\n    if (computedMatchForCacheRoute) {\r\n      restProps.computedMatch = computedMatchForCacheRoute\r\n    }\r\n\r\n    if (multiple && !isFragmentable) {\r\n      multiple = false\r\n    }\r\n\r\n    if (isNumber(multiple)) {\r\n      multiple = clamp(multiple, 1)\r\n    }\r\n\r\n    return (\r\n      /**\r\n       * Only children prop of Route can help to control rendering behavior\r\n       * 只有 Router 的 children 属性有助于主动控制渲染行为\r\n       */\r\n      <Route {...restProps}>\r\n        {props => {\r\n          window.history.scrollRestoration = 'manual'\r\n          const { match, computedMatch, location } = props\r\n          const isMatchCurrentRoute = isMatch(props.match)\r\n          const { pathname: currentPathname, search: currentSearch, state: currentState } = location\r\n          const maxMultipleCount = isNumber(multiple) ? multiple : Infinity\r\n          const configProps = {\r\n            when,\r\n            className,\r\n            behavior,\r\n            cacheKey,\r\n            unmount,\r\n            saveScrollPosition\r\n          }\r\n\r\n          const renderSingle = props => (\r\n            <CacheComponent {...props}>\r\n              {cacheLifecycles => (\r\n                <Updatable when={isMatch(props.match)}>\r\n                  {() => {\r\n                    Object.assign(props, { cacheLifecycles })\r\n\r\n                    if (component) {\r\n                      return React.createElement(component, props)\r\n                    }\r\n\r\n                    return run(render || children, undefined, props)\r\n                  }}\r\n                </Updatable>\r\n              )}\r\n            </CacheComponent>\r\n          )\r\n\r\n          let localCacheKey = currentPathname + currentSearch\r\n\r\n          if (multiple && isMatchCurrentRoute) {\r\n            const routeId = (currentState && currentState.routeId)\r\n            if (routeId) {\r\n              localCacheKey += routeId\r\n            } else {\r\n              const lastLocalCacheKey = getLastLocalCacheKey(this.cache)\r\n              if (lastLocalCacheKey) {\r\n                localCacheKey = lastLocalCacheKey\r\n              }\r\n            }\r\n\r\n            this.cache[localCacheKey] = {\r\n              updateTime: Date.now(),\r\n              pathname: currentPathname,\r\n              search: currentSearch,\r\n              render: renderSingle\r\n            }\r\n\r\n            console.log('cache', this.cache)\r\n\r\n            Object.entries(this.cache)\r\n              .sort(([, prev], [, next]) => next.updateTime - prev.updateTime)\r\n              .forEach(([pathname], idx) => {\r\n                if (idx >= maxMultipleCount) {\r\n                  delete this.cache[pathname]\r\n                }\r\n              })\r\n          }\r\n\r\n          return multiple ? (\r\n            <Fragment>\r\n              {Object.entries(this.cache).map(([multipleCacheKey, { render, pathname }]) => {\r\n                const recomputedMatch =\r\n                  multipleCacheKey === localCacheKey ? match || computedMatch : null\r\n\r\n                return (\r\n                  <Fragment key={multipleCacheKey}>\r\n                    {render({\r\n                      ...props,\r\n                      ...configProps,\r\n                      pathname,\r\n                      cacheKey,\r\n                      multiple: true,\r\n                      key: pathname,\r\n                      match: recomputedMatch\r\n                    })}\r\n                  </Fragment>\r\n                )\r\n              })}\r\n            </Fragment>\r\n          ) : (\r\n            renderSingle({\r\n              ...props,\r\n              ...configProps,\r\n              pathname: currentPathname,\r\n              multiple: false\r\n            })\r\n          )\r\n        }}\r\n      </Route>\r\n    )\r\n  }\r\n}\r\n\r\nexport function cachedNavigation ({ history, locationObject, state, isNew }) {\r\n  if (!state) {\r\n    state = {}\r\n  }\r\n\r\n  if (isNew) {\r\n    Object.assign(state, { routeId: counter++ })\r\n  }\r\n\r\n  history.push(locationObject, state)\r\n}\r\n\r\nfunction getLastLocalCacheKey(cache) {\r\n  const cacheEntries = Object.entries(cache)\r\n  if (cacheEntries.length === 0) {\r\n    return null\r\n  }\r\n\r\n  const sortedCacheEntries = cacheEntries.sort(([, prev], [, next]) => next.updateTime - prev.updateTime)\r\n  return sortedCacheEntries[sortedCacheEntries.length-1][0]\r\n}","import React, { PropTypes, Fragment } from 'react'\n\nimport { isExist } from '../helpers'\n\nfunction getFragment() {\n  if (isExist(Fragment)) {\n    return ({ children }) => <Fragment>{children}</Fragment>\n  }\n\n  if (isExist(PropTypes)) {\n    return ({ children }) => <div>{children}</div>\n  }\n\n  return ({ children }) => children\n}\n\nconst SwitchFragment = getFragment()\nSwitchFragment.displayName = 'SwitchFragment'\n\nexport default SwitchFragment\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Switch,\n  matchPath,\n  withRouter,\n  useHistory,\n  __RouterContext\n} from 'react-router-dom'\n\nimport { COMPUTED_UNMATCH_KEY, isMatch } from '../core/CacheComponent'\nimport Updatable from '../core/Updatable'\nimport SwitchFragment from './SwitchFragment'\nimport { get, isNull, isExist } from '../helpers'\n\nconst isUsingNewContext = isExist(__RouterContext) || isExist(useHistory)\n\nclass CacheSwitch extends Switch {\n  getContext = () => {\n    if (isUsingNewContext) {\n      const { location, match } = this.props\n\n      return { location, match }\n    } else {\n      const { route } = this.context.router\n      const location = this.props.location || route.location\n\n      return {\n        location,\n        match: route.match\n      }\n    }\n  }\n\n  render() {\n    const { children, which } = this.props\n    const { location, match: contextMatch } = this.getContext()\n\n    let __matchedAlready = false\n\n    return (\n      <Updatable when={isMatch(contextMatch)}>\n        {() => (\n          <SwitchFragment>\n            {React.Children.map(children, element => {\n              if (!React.isValidElement(element)) {\n                return null\n              }\n\n              const path = element.props.path || element.props.from\n              const match = __matchedAlready\n                ? null\n                : path\n                  ? matchPath(\n                      location.pathname,\n                      {\n                        ...element.props,\n                        path\n                      },\n                      contextMatch\n                    )\n                  : contextMatch\n\n              let child\n\n              if (which(element)) {\n                child = React.cloneElement(element, {\n                  location,\n                  computedMatch: match,\n                  /**\n                   * https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Route.js#L57\n                   *\n                   * Note:\n                   * Route would use computedMatch as its next match state ONLY when computedMatch is a true value\n                   * So here we have to do some trick to let the unmatch result pass Route's computedMatch check\n                   *\n                   * 注意：只有当 computedMatch 为真值时，Route 才会使用 computedMatch 作为其下一个匹配状态\n                   * 所以这里我们必须做一些手脚，让 unmatch 结果通过 Route 的 computedMatch 检查\n                   */\n                  ...(isNull(match)\n                    ? {\n                        computedMatchForCacheRoute: {\n                          [COMPUTED_UNMATCH_KEY]: true\n                        }\n                      }\n                    : null)\n                })\n              } else {\n                child =\n                  match && !__matchedAlready\n                    ? React.cloneElement(element, {\n                        location,\n                        computedMatch: match\n                      })\n                    : null\n              }\n\n              if (!__matchedAlready) {\n                __matchedAlready = !!match\n              }\n\n              return child\n            })}\n          </SwitchFragment>\n        )}\n      </Updatable>\n    )\n  }\n}\n\nif (isUsingNewContext) {\n  CacheSwitch.propTypes = {\n    children: PropTypes.node,\n    location: PropTypes.object.isRequired,\n    match: PropTypes.object.isRequired,\n    which: PropTypes.func\n  }\n\n  CacheSwitch = withRouter(CacheSwitch)\n} else {\n  CacheSwitch.contextTypes = {\n    router: PropTypes.shape({\n      route: PropTypes.object.isRequired\n    }).isRequired\n  }\n\n  CacheSwitch.propTypes = {\n    children: PropTypes.node,\n    location: PropTypes.object,\n    which: PropTypes.func\n  }\n}\n\nCacheSwitch.defaultProps = {\n  which: element => get(element, 'type.__name') === 'CacheRoute'\n}\n\nexport default CacheSwitch\n"],"names":["isUndefined","val","isNull","isFunction","isString","isExist","isArray","Array","isNaN","isNumber","get","obj","keys","defaultValue","String","result","split","reduce","res","key","e","run","args","func","context","slice","call","value","values","nextValue","undefined","getImplementation","self","window","global","Error","implementation","getGlobal","Math","globalThis","flatten","array","item","clamp","min","max","Number","MAX_VALUE","ObjectValues","object","push","body","root","screenScrollingElement","isScrollableNode","node","scrollWidth","clientWidth","scrollHeight","clientHeight","getScrollableNodes","from","filter","saveScrollPosition","nodes","Set","map","saver","scrollLeft","scrollTop","revert","forEach","x","y","__components","getCachedComponentEntries","Object","entries","cache","CacheComponent","state","cached","some","getCache","register","component","remove","dropComponent","dropByCacheKey","refreshComponent","refreshByCacheKey","clearCache","getCachingKeys","getCachingComponents","pathname","createContext","Provider","useCacheRoute","lifecycleName","effect","deps","useContext","cacheLifecycles","off","useDidCache","bind","useDidRecover","useIsInCachedRecoveredPage","useState","inCachedRecoveredPage","setInCachedRecoveredPage","useIsInActivePage","inActivePage","setInActivePage","isUsingNewLifecycle","React","forwardRef","COMPUTED_UNMATCH_KEY","isMatch","match","getDerivedStateFromProps","nextProps","prevState","nextPropsMatch","when","matched","nextAction","__cancel__cache","includes","props","yPosition","eventName","id","random","listenerKey","__listener","listener","componentWillReceiveProps","nextState","setState","injectDOM","__parentNode","wrapper","__placeholderNode","err","ejectDOM","parentNode","reset","__revertScrollPos","refresh","__cacheCreateTime","Date","now","__cacheUpdateTime","cacheKey","multiple","manager","document","createComment","prevProps","unmount","__didCacheListener","scrollTo","__didRecoverListener","willRecover","willDrop","shouldUpdate","shouldSaveScrollPosition","pageYOffset","length","className","propsClassName","behavior","children","behaviorClassName","behaviorProps","hasClassName","Component","__name","propsTypes","PropTypes","isRequired","string","oneOfType","oneOf","bool","defaultProps","Updatable","render","shouldComponentUpdate","isEmptyChildren","Children","count","isFragmentable","Fragment","counter","CacheRoute","computedMatchForCacheRoute","restProps","isValidElement","computedMatch","history","scrollRestoration","location","isMatchCurrentRoute","currentPathname","currentSearch","search","currentState","maxMultipleCount","Infinity","configProps","renderSingle","assign","createElement","localCacheKey","routeId","lastLocalCacheKey","getLastLocalCacheKey","log","sort","prev","next","updateTime","idx","multipleCacheKey","recomputedMatch","propTypes","elementType","any","number","cachedNavigation","locationObject","isNew","cacheEntries","sortedCacheEntries","getFragment","SwitchFragment","displayName","isUsingNewContext","__RouterContext","useHistory","CacheSwitch","getContext","route","router","which","contextMatch","__matchedAlready","element","path","matchPath","child","cloneElement","Switch","withRouter","contextTypes","shape"],"mappings":"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"}