!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("mini-create-react-context"),require("prop-types"),require("react-router-dom")):"function"==typeof define&&define.amd?define(["exports","react","mini-create-react-context","prop-types","react-router-dom"],t):t(e.CacheRoute={},e.React,e.createContext,e.PropTypes,e.reactRouterDom)}(this,function(e,P,t,n,u){"use strict";var E="default"in P?P.default:P;t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;var o=function(e){return void 0===e},l=function(e){return null===e},i=function(e){return"function"==typeof e},s=function(e){return"string"==typeof e},r=function(e){return!(o(e)||l(e))},c=function(e){return e instanceof Array},R=function(e){return"number"==typeof e&&!((t=e)!=t);var t},h=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];try{R(t)&&(t=String(t));var r=(s(t)?t.split("."):t).reduce(function(e,t){return e[t]},e);return o(r)?n:r}catch(e){return n}},S=function(e){for(var t=arguments.length,n=Array(2<t?t-2:0),r=2;r<t;r++)n[r-2]=arguments[r];var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];o=s(o)?o.split("."):o;var c=h(e,o),a=h(e,o.slice(0,-1));return i(c)?c.call.apply(c,[a].concat(n)):c},v=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return o(e)?S(t):S(e)},void 0)},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),p=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},N=function(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},L=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,c=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,c=e}finally{try{!r&&i.return&&i.return()}finally{if(o)throw c}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},b=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},_=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}(),w="object"===("undefined"==typeof global?"undefined":a(global))&&global&&global.Math===Math&&global.Array===Array?global:_,g=function(e){var t=[];for(var n in e)t.push(e[n]);return t},O=h(w,"document.body"),C=h(w,"document.scrollingElement",h(w,"document.documentElement",{}));function j(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return!!r(e)&&(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight)}function A(e){return i(h(w,"document.getElementById"))?[].concat(b(v(S(e,"querySelectorAll","*"),[])),[e]).filter(j):[]}function M(e){var t=[].concat(b(new Set([].concat(b(function n(e){return e.reduce(function(e,t){return[].concat(b(e),b(c(t)?n(t):[t]))},[])}((c(e)?e:[e]).map(A))),b([C,O].filter(j)))))).map(function(e){return[e,{x:e.scrollLeft,y:e.scrollTop}]});return function(){t.forEach(function(e){var t=L(e,2),n=t[0],r=t[1],o=r.x,c=r.y;n.scrollLeft=o,n.scrollTop=c})}}var k={},x=function(){return Object.entries(k).filter(function(e){var t=L(e,2)[1];return t instanceof Q?t.state.cached:Object.values(t).some(function(e){return e.state.cached})})},D=function(){return T({},k)},q=function(e,t){k[e]=t},K=function(e){delete k[e]},F=function(e){return S(e,"reset")},U=function(e){var t=h(k,[e]);t&&(t instanceof Q?F(t):Object.values(t).forEach(F))},I=function(e){return S(e,"refresh")},B=t(),H=B.Provider;function W(t,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];if(i(P.useContext)){var r=P.useContext(B);P.useEffect(function(){var e=S(r,"on",t,n);return function(){return S(e)}},e)}}var V=W.bind(null,"didCache"),X=W.bind(null,"didRecover"),Y=r(E.forwardRef),z="__isComputedUnmatch",G=function(e){return r(e)&&!0!==h(e,z)},J=function(e,t){var n=e.match,r=e.when,o=void 0===r?"forward":r;if(G(n)||(n=null),!t.cached&&n)return{cached:!0,matched:!0};if(t.matched&&!n){var c=h(e,"history.action"),a=!1;if(i(o))a=!o(e);else switch(o){case"always":break;case"back":["PUSH","REPLACE"].includes(c)&&(a=!0);break;case"forward":default:"POP"===c&&(a=!0)}if(a)return{cached:!1,matched:!1}}return{matched:!!n}},Q=function(e){function l(e){var t;f(this,l);for(var n=arguments.length,r=Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var c=y(this,(t=l.__proto__||Object.getPrototypeOf(l)).call.apply(t,[this,e].concat(r)));if(c.yPosition=0,c.cacheLifecycles={__listener:{},__didCacheListener:{},__didRecoverListener:{},on:function(e,t){var n=Math.random(),r="__"+e+"Listener";return c.cacheLifecycles[r][n]=t,function(){delete c.cacheLifecycles[r][n]}},didCache:function(e){c.cacheLifecycles.__listener.didCache=e},didRecover:function(e){c.cacheLifecycles.__listener.didRecover=e}},c.componentWillReceiveProps=Y?void 0:function(e){var t=J(e,c.state);c.setState(t)},c.injectDOM=function(){try{S(c.__parentNode,"insertBefore",c.wrapper,c.__placeholderNode),S(c.__parentNode,"removeChild",c.__placeholderNode)}catch(e){}},c.ejectDOM=function(){try{var e=h(c.wrapper,"parentNode");c.__parentNode=e,S(c.__parentNode,"insertBefore",c.__placeholderNode,c.wrapper),S(c.__parentNode,"removeChild",c.wrapper)}catch(e){}},c.reset=function(){delete c.__revertScrollPos,c.setState({cached:!1})},c.refresh=function(){delete c.__revertScrollPos,c.setState({key:Math.random()})},c.__cacheCreateTime=Date.now(),c.__cacheUpdateTime=c.__cacheCreateTime,e.cacheKey){var a=S(e.cacheKey,void 0,e);if(e.multiple){var i=e.pathname;q(a,T({},D()[a],p({},i,c)))}else q(a,c)}if("undefined"!=typeof document){var u=S(e.cacheKey,void 0,e);c.__placeholderNode=document.createComment(" Route cached "+(u?'with cacheKey: "'+u+'" ':""))}return c.state=J(e,{cached:!1,matched:!1,key:Math.random()}),c}return m(l,e),d(l,[{key:"componentDidUpdate",value:function(e,t){if(t.cached&&this.state.cached)return!0===t.matched&&!1===this.state.matched?(this.props.unmount&&this.ejectDOM(),this.__cacheUpdateTime=Date.now(),g(this.cacheLifecycles.__didCacheListener).forEach(function(e){S(e)}),S(this,"cacheLifecycles.__listener.didCache")):!1===t.matched&&!0===this.state.matched?(this.props.saveScrollPosition&&S(this.__revertScrollPos),this.__cacheUpdateTime=Date.now(),window.scrollTo(0,this.yPosition),g(this.cacheLifecycles.__didRecoverListener).forEach(function(e){S(e)}),S(this,"cacheLifecycles.__listener.didRecover")):void 0}},{key:"shouldComponentUpdate",value:function(e,t){var n=!1===this.state.matched&&!0===t.matched,r=!0===this.state.cached&&!1===t.cached,o=this.state.matched||t.matched||this.state.cached!==t.cached;if(o){(this.props.unmount&&r||n)&&this.injectDOM();var c=!(r||n);c&&(this.yPosition=window.pageYOffset),c&&this.props.saveScrollPosition&&(this.__revertScrollPos=M(this.props.unmount?this.wrapper:void 0))}return o}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.unmount,n=e.pathname,r=e.multiple,o=S(this.props,"cacheKey",this.props);if(r){var c=T({},D()[o]);delete c[n],0===Object.keys(c).length?K(o):q(o,c)}else K(o);t&&this.injectDOM()}},{key:"render",value:function(){var t=this,e=this.state,n=e.matched,r=e.cached,o=e.key,c=this.props,a=c.className,i=void 0===a?"":a,u=c.behavior,l=c.children,s=v(S(u,void 0,!n),{}),h=s.className,f=void 0===h?"":h,d=N(s,["className"]),p=S(i+" "+f,"trim"),m=""!==p;return r?E.createElement("div",T({key:o,className:m?p:void 0},d,{ref:function(e){t.wrapper=e}}),E.createElement(H,{value:this.cacheLifecycles},S(l,void 0,this.cacheLifecycles))):null}}]),l}(P.Component);Q.__name="CacheComponent",Q.propsTypes={history:n.object.isRequired,match:n.object.isRequired,children:n.func.isRequired,className:n.string,when:n.oneOfType([n.func,n.oneOf(["forward","back","always"])]),behavior:n.func,unmount:n.bool,saveScrollPosition:n.bool},Q.defaultProps={when:"forward",unmount:!1,saveScrollPosition:!1,behavior:function(e){return e?{style:{display:"none"}}:void 0}},Q.getDerivedStateFromProps=Y?J:void 0;var Z=function(e){function a(){var e,t,n;f(this,a);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=y(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).render=function(){return S(n.props,"children")},n.shouldComponentUpdate=function(e){return e.when},y(n,t)}return m(a,e),a}(P.Component);Z.propsTypes={when:n.bool.isRequired};var $=r(P.Fragment),ee=0,te=function(e){function a(){var e,t,n;f(this,a);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=y(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).cache={},y(n,t)}return m(a,e),d(a,[{key:"render",value:function(){var e,p=this,t=this.props,m=t.children,v=t.render,y=t.component,b=t.className,_=t.when,w=t.behavior,g=t.cacheKey,O=t.unmount,C=t.saveScrollPosition,n=t.computedMatchForCacheRoute,j=t.multiple,r=N(t,["children","render","component","className","when","behavior","cacheKey","unmount","saveScrollPosition","computedMatchForCacheRoute","multiple"]);return(E.isValidElement(m)||(e=m,0!==E.Children.count(e)))&&(v=function(){return m}),n&&(r.computedMatch=n),j&&!$&&(j=!1),R(j)&&(j=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE;return e<t?t:n<e?n:e}(j,1)),E.createElement(u.Route,r,function(i){window.history.scrollRestoration="manual";var u=i.match,l=i.computedMatch,e=i.location,t=G(i.match),n=e.pathname,r=e.search,o=e.state,c=R(j)?j:1/0,s={when:_,className:b,behavior:w,cacheKey:g,unmount:O,saveScrollPosition:C},a=function(t){return E.createElement(Q,t,function(e){return E.createElement(Z,{when:G(t.match)},function(){return Object.assign(t,{cacheLifecycles:e}),y?E.createElement(y,t):S(v||m,void 0,t)})})},h=n+r;if(j&&t){var f=o&&o.routeId;if(f)h+=f;else{var d=function(e){var t=Object.entries(e);if(0===t.length)return null;var n=t.sort(function(e,t){var n=L(e,2),r=n[1],o=L(t,2),c=o[1];return r.updateTime-c.updateTime});return n[n.length-1][0]}(p.cache);d&&(h=d)}p.cache[h]={updateTime:Date.now(),pathname:n,search:r,render:a},Object.entries(p.cache).sort(function(e,t){var n=L(e,2)[1];return L(t,2)[1].updateTime-n.updateTime}).forEach(function(e,t){var n=L(e,1)[0];c<=t&&delete p.cache[n]})}return j?E.createElement(P.Fragment,null,Object.entries(p.cache).map(function(e){var t=L(e,2),n=t[0],r=t[1],o=r.render,c=r.pathname,a=n===h?u||l:null;return E.createElement(P.Fragment,{key:n},o(T({},i,s,{pathname:c,cacheKey:g,multiple:!0,key:c,match:a})))})):a(T({},i,s,{pathname:n,multiple:!1}))})}}]),a}(P.Component);te.__name="CacheRoute",te.propTypes={component:n.elementType||n.any,render:n.func,children:n.oneOfType([n.func,n.node]),computedMatchForCacheRoute:n.object,multiple:n.oneOfType([n.bool,n.number])},te.defaultProps={multiple:!1};var ne=r(P.Fragment)?function(e){var t=e.children;return E.createElement(P.Fragment,null,t)}:r(P.PropTypes)?function(e){var t=e.children;return E.createElement("div",null,t)}:function(e){return e.children};ne.displayName="SwitchFragment";var re=r(u.__RouterContext)||r(u.useHistory),oe=function(e){function a(){var e,t,n;f(this,a);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return(t=n=y(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o)))).getContext=function(){if(re){var e=n.props;return{location:e.location,match:e.match}}var t=n.context.router.route;return{location:n.props.location||t.location,match:t.match}},y(n,t)}return m(a,e),d(a,[{key:"render",value:function(){var e=this.props,t=e.children,o=e.which,n=this.getContext(),c=n.location,a=n.match,i=!1;return E.createElement(Z,{when:G(a)},function(){return E.createElement(ne,null,E.Children.map(t,function(e){if(!E.isValidElement(e))return null;var t=e.props.path||e.props.from,n=i?null:t?u.matchPath(c.pathname,T({},e.props,{path:t}),a):a,r=void 0;return r=o(e)?E.cloneElement(e,T({location:c,computedMatch:n},l(n)?{computedMatchForCacheRoute:p({},z,!0)}:null)):n&&!i?E.cloneElement(e,{location:c,computedMatch:n}):null,i||(i=!!n),r}))})}}]),a}(u.Switch);re?(oe.propTypes={children:n.node,location:n.object.isRequired,match:n.object.isRequired,which:n.func},oe=u.withRouter(oe)):(oe.contextTypes={router:n.shape({route:n.object.isRequired}).isRequired},oe.propTypes={children:n.node,location:n.object,which:n.func}),oe.defaultProps={which:function(e){return"CacheRoute"===h(e,"type.__name")}};var ce=oe;e.default=te,e.CacheRoute=te,e.CacheSwitch=ce,e.cachedNavigation=function(e){var t=e.history,n=e.locationObject,r=e.state,o=e.isNew,c=e.method,a=void 0===c?"push":c;r||(r={}),o&&Object.assign(r,{routeId:ee++}),("push"===a?t.push:t.replace)(n,r)},e.dropByCacheKey=U,e.refreshByCacheKey=function(e){var t=h(k,[e]);t&&(t instanceof Q?I(t):Object.values(t).forEach(I))},e.getCachingKeys=function(){return x().map(function(e){return L(e,1)[0]})},e.clearCache=function(){x().forEach(function(e){var t=L(e,1)[0];return U(t)})},e.getCachingComponents=function(){return x().reduce(function(e,t){var n=L(t,2),c=n[0],r=n[1];return T({},e,r instanceof Q?p({},c,r):Object.entries(r).reduce(function(e,t){var n=L(t,2),r=n[0],o=n[1];return T({},e,p({},c+"."+r,o))},{}))},{})},e.useDidCache=V,e.useDidRecover=X,e.useIsInCachedRecoveredPage=function(){var e=P.useState(!1),t=L(e,2),n=t[0],r=t[1];return X(function(){return r(!0)}),n},e.useIsInActivePage=function(){var e=P.useState(!0),t=L(e,2),n=t[0],r=t[1];return P.useEffect(function(){return r(!0)},[]),X(function(){return r(!0)}),V(function(){return r(!1)}),n},Object.defineProperty(e,"__esModule",{value:!0})});
